---
import Base from "@layouts/Base.astro";
import Header from "@components/Header.astro";
import CommentWidget from "@components/blog/CommentWidget.astro";

import "remark-github-blockquote-alert/alert.css";

import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("blogs");
  return posts.map((post) => ({
    params: { blog: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const {
  title,
  description,
  date,
  thumb,
  tags,
  keywords,
  draft = false,
} = post.data;
import "/src/styles/post.css"
---

<Base {title} {description} image={thumb?.src ?? ""} keywords={keywords}>
  <Header />
  <main>
    <article>
      <header>
          <Image id="bg-img" src={thumb} alt={description} loading="eager" layout="full-width" priority />
        <div id="hero-text">
          <h1>{title}</h1>
          <p>
            {description}
            <br />
            <time datetime={date.toISOString()}>
              {
                date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })
              }
            </time>
            {" | "}
            <span>
              {
                tags.map((tag, i) => {
                  const href = `/tags/${encodeURIComponent(tag)}/`;
                  return (
                    <>
                      <!-- prettier-ignore -->
                      <a href={href}>{tag}</a>{i < tags.length - 1 ? ", " : ""}
                    </>
                  );
                })
              }
            </span>
            {
              draft && (
                <span id="draft-warn">
                  <br />
                  (Draft - Not final content)
                </span>
              )
            }
            <span id="scroll-warn">
              <br />Note: Firefox/Your Browser doesn't natively support
              scroll-timeline. So the background image scrolling won't work as
              expected even with a polyfill
            </span>
          </p>
        </div>
      </header>
      <section>
        <Content />
        <CommentWidget />
      </section>
    </article>
  </main>
</Base>

<script src="https://flackr.github.io/scroll-timeline/dist/scroll-timeline.js"
></script>

<style is:inline>
  #contents {
    display: none;
  }

  #contents + ul {
    scrollbar-width: none;

    position: fixed;
    top: 0;
    left: 0;

    overflow: hidden;

    width: 2vw;
    height: 100%;
    padding: 1rem;
    padding-top: 5vh;
    border-radius: 0 20px;

    filter: drop-shadow(0 0 5px black);
    backdrop-filter: blur(10px) brightness(0.8);

    transition: 400ms;

    &::before {
      content: "Contents";

      display: block;

      padding: 0.5rem 0;
      border-bottom: 1px solid rgb(255 255 255 / 20%);

      font-family: var(--font-heading);
      font-size: 1.5rem;
    }

        li {
      overflow: hidden;

      font-size: 1rem;
      line-height: 1.5;
      text-overflow: ellipsis;
      white-space: nowrap;
      list-style-position: inside;

      ul {
        padding-left: 15px;
      }
    }

    &:hover,
    &:focus-within {
      overflow-y: scroll;
      width: 250px;
    }

  }
</style>
